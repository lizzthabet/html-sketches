<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>sketch four</title>

    <style>
      html {
        background-color: #d3d3d3;
      }

      .nav-link {
        font-size: 1.5rem;
        color: white;
        text-shadow: 5px 5px 5px #333333;
      }

      /* dialogs should manage their own display */
      [data-draggable]:not(dialog) {
        display: inline-block;
      }

      [data-draggable] {
        user-select: none;
        margin: 0;
        padding: 1rem;
      }

      [data-draggable]:hover {
        cursor: move;
      }

      header {
        padding: 1rem;
        z-index: 1;
      }

      header > h1 {
        font-family: monospace;
        font-style: italic;
        color: blue;
        text-shadow: 5px 5px 5px rgb(51, 51, 51, 0.50);
      }

      menu {
        list-style: none;
        position: absolute;
        top: 0;
        right: 0;
        margin: 8px;
      }

      button.filename {
        background-color: #d2d2d2;
        border: none;
        border-radius: 8px;
        box-shadow: 5px 5px 5px rgb(51, 51, 51, 0.75);
        color: blue;
        font-family: 'Times New Roman', Times, serif;
        font-size: 1rem;
        max-width: 250px;
        padding: 5px;
        overflow-wrap: anywhere;
        text-align: center;
        text-decoration: underline;
        width: max-content;
      }

      button.filename:focus {
        background-color: purple;
        color: white;
        outline: none;
        text-decoration: none;
      }

      button.close-fileviewer {
        background-color: unset;
        border: none;
        color: #333333;
        font-family: monospace;
        float: right;
        margin: 0.5rem -0.5rem -0.5rem 0.5rem;
        text-transform: uppercase;
      }

      button.close-fileviewer:active,
      button.close-fileviewer:focus {
        background-color: purple;
        border-radius: 5px;
        color: white;
        outline: none;
      }

      dialog.fileviewer[open] {
        background-color: #dfdfdf;
        box-shadow: 5px 5px 5px rgb(51, 51, 51, 0.75);
        border-radius: 8px;
        border: 2px dotted #333333;
        z-index: 2;
      }

      object[type="application/pdf"] {
        width: 400px;
        height: 250px;
      }

      /* add all different types of queries! */
    </style>
    <script>
      function positionInPlace(element) {
        const { top, left } = element.getBoundingClientRect()
        const { scrollX, scrollY } = window
        setTopLeft(element, top + scrollY, left + scrollX)
      }

      function setTopLeft(element, top, left) {
        element.style.setProperty("top", `${top}px`)
        element.style.setProperty("left", `${left}px`)
      }

      function setPositionAbsolute(element) {
        element.style.setProperty("position", "absolute")
      }

      function onMouseDown(event) {
        console.log("mousedown", event)
        event.stopPropagation()
        const { currentTarget, target, pageX, pageY, clientX, clientY, type } = event
        // Get the position of the element
        const { left, top } = currentTarget.getBoundingClientRect()
        // Use the position of the mouse to the element it's moving
        // to offset the final position of the element
        const shiftX = clientX - left
        const shiftY = clientY - top

        function moveTo(pageX, pageY) {
          const newLeft = pageX - shiftX + "px"
          const newTop = pageY - shiftY + "px"
          currentTarget.style.setProperty("left", newLeft)
          currentTarget.style.setProperty("top", newTop)
        }

        function onMouseMove(event) {
          moveTo(event.pageX, event.pageY)
        }

        function onMouseUp() {
          document.removeEventListener("mousemove", onMouseMove)
          document.removeEventListener("mouseup", onMouseUp)
        }
        document.addEventListener("mousemove", onMouseMove)
        document.addEventListener("mouseup", onMouseUp)
      }

      function onTouchStart(event) {
        console.log("touchstart")
        event.stopPropagation()
        // TODO: Need to use the `touches` object to 
        const { target, pageX, pageY, clientX, clientY } = event
        // Get the position of the element
        const { left, top } = target.getBoundingClientRect()
        // Use the position of the mouse to the element it's moving
        // to offset the final position of the element
        const shiftX = clientX - left
        const shiftY = clientY - top

        console.log("left", left, "top", top, "x", clientX, "y", clientY)

        function moveTo(pageX, pageY) {
          const newLeft = pageX - shiftX + "px"
          const newTop = pageY - shiftY + "px"
          target.style.setProperty("left", newLeft)
          target.style.setProperty("top", newTop)
        }

        function onTouchMove(event) {
          moveTo(event.pageX, event.pageY)
        }

        function onTouchEnd() {
          document.removeEventListener("touchmove", onTouchMove)
          document.removeEventListener("touchend", onTouchEnd)
        }

        document.addEventListener("touchmove", onTouchMove)
        document.addEventListener("touchend", onTouchEnd)
      }

      // TODO: Trigger this action with keyboard space + enter keys, plus a tap for mobile experience?
      const DOUBLE_CLICK = 2
      function onDoubleClick(e) {
        if (e.detail === DOUBLE_CLICK) {
          const dialogId = e.currentTarget.getAttribute("aria-controls")
          if (!dialogId) {
            return
          }
          const dialog = document.getElementById(dialogId)
          if (!dialog) {
            return
          }
          if (dialog.open === false) {
            const { top, left, height, width } = e.currentTarget.getBoundingClientRect()
            const { scrollX, scrollY } = window
            setTopLeft(dialog, top + height + scrollY + 10, left + scrollX)
            setPositionAbsolute(dialog)
            dialog.show()
          }
        }
      }

      window.addEventListener("load", (event) => {
        const elements = document.querySelectorAll("[data-draggable]")
        // Position each element absolutely so document flow isn't changed
        // when one element is moved
        elements.forEach(positionInPlace)
        elements.forEach(setPositionAbsolute)
        // Add drag-to-move functionality
        elements.forEach((ele) => {
          ele.addEventListener("mousedown", onMouseDown)
          // ele.addEventListener("touchstart", onTouchStart)
        })

        // Remove the native draggable functionality on all images, so it
        // doesn't interfere with drag-to-move
        const images = document.querySelectorAll('img')
        images.forEach(e => e.setAttribute('draggable', false))

        // Add double-click listener to open up fileviewer
        const fileviewers = document.querySelectorAll("[data-fileviewer]")
        fileviewers.forEach((ele) => {
          ele.addEventListener("click", onDoubleClick)
        })
      })
  </script>
  </head>
  <body>
    <nav>
      <a class="nav-link" href="/">back</a>
    </nav>
    <header data-draggable style="top: 250px; left: 294px; position: absolute;">
      <h1>welcome</h1>
    </header>
    <main>
      <button
        class="filename"
        style="top: 876px; left: 199px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="sample-of-homegrown.pdf"
        data-fileviewer
        data-draggable>
        sample-of-homegrown.pdf
      </button>
      <dialog class="fileviewer" id="sample-of-homegrown.pdf" data-draggable>
        <object class="file" type="application/pdf" data="./assets/sample-of-homegrown.pdf" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 1120px; left: 1365.39px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="future-feelings.txt"
        data-fileviewer
        data-draggable>
        future-feelings.txt
      </button>
      <dialog class="fileviewer" id="future-feelings.txt" data-draggable>
        <object class="file" data="./assets/future-feelings.txt" width="550px" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 231px; left: 1209.47px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="hm/"
        data-fileviewer
        data-draggable>
        hm/
      </button>
      <!-- TODO: how should empty folders be displayed? -->
      <dialog class="fileviewer" id="hm/" data-draggable>
        <pre>empty folder</pre>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 534px; left: 2275.8px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="i-am-an-aspiring-teacher.png"
        data-fileviewer
        data-draggable>
        i-am-an-aspiring-teacher.png
      </button>
      <dialog class="fileviewer" id="i-am-an-aspiring-teacher.png" data-draggable>
        <object class="file" data="./assets/i-am-an-aspiring-teacher.png" width="550px" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 976px; left: 953.797px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="not-all-features.png"
        data-fileviewer
        data-draggable>
        not-all-features.png
      </button>
      <dialog class="fileviewer" id="not-all-features.png" data-draggable>
        <object class="file" data="./assets/not-all-features.png" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 919px; left: 952.516px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="ScreenShot2021-03-09at10.19.53PM.png"
        data-fileviewer
        data-draggable>
        ScreenShot2021-03-09at10.19.53PM.png
      </button>
      <!-- TODO: note that files with spaces in name are broken on dev server, need to check with other servers -->
      <dialog class="fileviewer" id="ScreenShot2021-03-09at10.19.53PM.png" data-draggable>
        <object class="file" data="./assets/ScreenShot2021-03-09at10.19.53PM.png" width="300px" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 91px; left: 501.516px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="welcome/hello,goodday!!!!.png"
        data-fileviewer
        data-draggable>
        welcome/hello,goodday!!!!.png
      </button>
      <dialog class="fileviewer" id="welcome/hello,goodday!!!!.png" data-draggable>
        <object class="file" data="./assets/welcome/hello,goodday!!!!.png" width="400px" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 517px; left: 739.516px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="would-you-like-to/find-out.jpeg"
        data-fileviewer
        data-draggable>
        would-you-like-to/find-out.jpeg
      </button>
      <dialog class="fileviewer" id="would-you-like-to/find-out.jpeg" data-draggable>
        <object class="file" data="./assets/would-you-like-to/find-out.jpeg" width="300px" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <button
        class="filename"
        style="top: 1136px; left: 599.516px; position: absolute;"
        aria-haspopup="dialog"
        aria-controls="you-deserve-a.png"
        data-fileviewer
        data-draggable>
        you-deserve-a.png
      </button>
      <dialog class="fileviewer" id="you-deserve-a.png" data-draggable>
        <object class="file" data="./assets/you-deserve-a.png" width="150px" draggable="false"></object>
        <form method="dialog"><button class="close-fileviewer" aria-label="close">close</button></form>
      </dialog>
      <section aria-label="furniture">
        <img src="./assets/test-banner-1@3x.png" data-draggable="" style="top: 216.875px; left: 113px; position: absolute;" draggable="false">
        <section aria-label="main living room space">
          <img src="./assets/test-arm-chair-1@3x.png" data-draggable="" style="top: 764.875px; left: 1762px; position: absolute;" draggable="false">
          <img src="./assets/test-bookcase-1@3x.png" data-draggable="" style="top: 375.875px; left: 1010px; position: absolute;" draggable="false">
          <img src="./assets/test-coffee-table-1@3x.png" data-draggable="" style="top: 778.875px; left: 1009px; position: absolute;" draggable="false">
          <img src="./assets/test-couch@3x.png" data-draggable="" style="top: 549.875px; left: 1254px; position: absolute;" draggable="false">
          <img src="./assets/test-lounge-chair@3x.png" data-draggable="" style="top: 592.875px; left: 760px; position: absolute;" draggable="false">
          <img src="./assets/test-rug-1@3x.png" data-draggable="" style="top: 763.875px; left: 1384px; position: absolute;" draggable="false">
          <img src="./assets/test-side-table-3@3x.png" data-draggable="" style="top: 589.875px; left: 1699px; position: absolute;" draggable="false">
          <img src="./assets/test-book-1@3x.png" data-draggable="" style="top: 773.875px; left: 1138px; position: absolute;" draggable="false">
          <img src="./assets/test-bench-1@3x.png" data-draggable="" style="top: 1016px; left: 1298px; position: absolute;" draggable="false">
          <img src="./assets/test-flowers@3x.png" data-draggable="" style="top: 700.875px; left: 1048px; position: absolute;" draggable="false">
          <img src="./assets/test-lamp-1@3x.png" data-draggable="" style="top: 497.875px; left: 1714px; position: absolute;" draggable="false">
        </section>
        <section aria-label="mini living room for side conversations">
          <img src="./assets/test-bean-bag@3x.png" data-draggable="" style="top: 950.875px; left: 79px; position: absolute;" draggable="false">
          <img src="./assets/test-plant-1@3x.png" data-draggable="" style="top: 897.875px; left: 405px; position: absolute;" draggable="false">
          <img src="./assets/test-shelf-1@3x.png" data-draggable="" style="top: 711.875px; left: 144px; position: absolute;" draggable="false">
          <img src="./assets/test-side-table-2@3x.png" data-draggable="" style="top: 1116.88px; left: 319px; position: absolute;" draggable="false">
          <img src="./assets/test-stool@3x.png" data-draggable="" style="top: 950.875px; left: 545px; position: absolute;" draggable="false">
        </section>
        <section aria-label="cozy reading nook">
          <img src="./assets/test-rocking-chair@3x.png" data-draggable="" style="top: 300px; left: 2050px; position: absolute;" draggable="false">
          <img src="./assets/test-side-table-1@3x.png" data-draggable="" style="top: 341px; left: 2240px; position: absolute;" draggable="false">
          <img src="./assets/test-lamp-2@3x.png" data-draggable="" style="top: 250px; left: 2239px; position: absolute;" draggable="false">
          <img src="./assets/test-book-2@3x.png" data-draggable="" style="top: 313px; left: 2374px; position: absolute;" draggable="false">
        </section>
        <section aria-label="kitchen prep area">
          <img src="./assets/test-chair-1@3x.png" data-draggable="" style="top: 1300px; left: 1195px; position: absolute;" draggable="false">
          <img src="./assets/test-chair-5@3x.png" data-draggable="" style="top: 1368px; left: 1020px; position: absolute;" draggable="false">
          <img src="./assets/test-table-1@3x.png" data-draggable="" style="top: 1430px; left: 1163px; position: absolute;" draggable="false">
          <img src="./assets/test-chair-2@3x.png" data-draggable="" style="top: 1551px; left: 1501px; position: absolute;" draggable="false">
          <img src="./assets/test-chair-3@3x.png" data-draggable="" style="top: 1419px; left: 1439px; position: absolute;" draggable="false">
          <img src="./assets/test-chair-4@3x.png" data-draggable="" style="top: 1622px; left: 1206px; position: absolute;" draggable="false">
          <img src="./assets/test-coffee-table-2@3x.png" data-draggable="" style="top: 1541px; left: 690px; position: absolute;" draggable="false">
          <img src="./assets/test-tray@3x.png" data-draggable="" style="top: 1487px; left: 718px; position: absolute;" draggable="false">
        </section>
      </section>

    </main>
  </body>
</html>