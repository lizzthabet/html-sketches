<!DOCTYPE html>
<html lang="en" class="grid">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>less game, more website - scene 1</title>
    <link rel="stylesheet" type="text/css" href="./styles_shared.css" />
    <link rel="stylesheet" type="text/css" href="./styles_website.css" />
    <script src="./gameplay.js" defer></script>
    <style>
      #ocean {
        border-radius: 25px 0 0 25px;
        height: calc(50px * 12);
        width: calc(2000px - 50px * 4);
      }

      #island {
        border-right: none;
        height: calc(50px * 10);
        width: calc(2000px - 50px * 5);
      }
    </style>
    <script>
      const initialPositions = {
        "#you": [{ x: 1, y: 2 }],
        ".tree": [
          { x: 7, y: 10 },
          { x: 12, y: 8 },
          { x: 18, y: 13 },
          { x: 19, y: 12 },
          { x: 24, y: 6 },
        ],
        ".crab": [{ x: 11, y: 15 }],
        ".shell": [{ x: 15, y: 5 }],
        "#island": [{ x: 5, y: 5, center: false }],
        "#ocean": [{ x: 4, y: 4, center: false }],
        "#next": [{ x: 38, y: 9 }],
      }

      const state = {
        boundaries: [
          {startX: 0, startY: 0, endX: 2000/50 - 1, endY: 1000/50 - 1},
        ],
        obstacles: [],
        activeArea: null,
        activeAreas: [
          // this isn't a very good activation lol
          // top border of the island will be activated
          {startX: 5, startY: 5, endX: 40, endY: 5, activation: () => updateDirection("Your island is far away from any neighboring shores...")},
          // bottom border of the island will be activated
          {startX: 5, startY: 5, endX: 5, endY: 14, activation: () => updateDirection("Your island is far away from any neighboring shores...")},
          {startX: 11, startY: 7, endX: 13, endY: 9, activation: () => updateDirection("But you have access to a network of fellow wayfinders who work to deliver messages all over.")},
          {startX: 18, startY: 11, endX: 20, endY: 13,
            activation: () => {
              updateDirection("Let's go find them.")
              const next = document.getElementById("next")
              if (next) {
                next.classList.remove("hidden")
              }
            }
          },
          {startX: 37, startY: 9, endX: 39, endY: 10, activation: () => window.location.assign("./websitevibe-scene2.html")}
        ]
      }

      function toggleGrid() {
        const html = document.documentElement
        if (html && html.classList.contains("grid")) {
          html.classList.remove("grid")
        } else if (html) {
          html.classList.add("grid")
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
         // position elements on grid based on their pre-defined locations
        for (const selector of Object.keys(initialPositions)) {
          const positions = initialPositions[selector]
          positionOnGridBySelector(selector, positions)
        }

        // get the tagged obstacles and record their grid positions
        const obstacles = document.querySelectorAll('[data-obstacle]')
        obstacles.forEach((o) => {
          const { scrollX, scrollY } = window
          const { top, left, width, height } = o.getBoundingClientRect()
          const position = { startX: pixelsToGrid(scrollX + left), startY: pixelsToGrid(scrollY + top) }
          if (width > GRID_SIZE_PX) {
            const widthExceedingCell = width - GRID_SIZE_PX
            position.endX = pixelsToGrid(scrollX + left + widthExceedingCell)
          }

          if (height > GRID_SIZE_PX) {
            const heightExceedingCell = height - GRID_SIZE_PX
            position.endY = pixelsToGrid(scrollY + top + heightExceedingCell)
          }
          state.obstacles.push(position)
        })

        // Move the avatar based on arrow presses
        document.addEventListener("keydown", onKeyDown)
      })
    </script>
  </head>
  <body>
    <nav>
      <a href="/">back</a>
      <button class="toggle" onclick="toggleGrid()">toggle grid</button>
    </nav>
    <main>
      <p id="direction" class="hidden"></p>
      <figure id="you" class="cell center">you</figure>
      <section id="ocean" class="left"></section>
      <section id="island" class="left">island</section>
      <figure class="tree cell center" data-obstacle></figure>
      <figure class="tree cell center" data-obstacle>tree</figure>
      <figure class="tree cell center" data-obstacle></figure>
      <figure class="tree cell center" data-obstacle>tree</figure>
      <figure class="tree cell center" data-obstacle></figure>
      <a id="next" class="hidden center cell" href="./websitevibe-scene2.html">next</a>
      <!-- <figure class="crab cell center" data-obstacle>crab</figure> -->
      <!-- <figure class="shell cell center" data-obstacle>shell</figure> -->
    </main>
  </body>
</html>